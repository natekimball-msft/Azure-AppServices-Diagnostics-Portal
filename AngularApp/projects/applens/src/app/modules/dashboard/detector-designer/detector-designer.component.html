<div style="width: 100%;">
    <div style = "display: flex; justify-content: left;align-items: baseline;">
        <fab-text-field [ariaLabel]="'Detector Name'" [styles]="fabTextFieldStyle" [label]="'Name'" [required]="true" [getErrorMessage]="getRequiredErrorMessageOnTextField" 
        [(value)]="detectorName" [autoComplete]="'off'" (onBlur)="onBlurDetectorName($event)" ></fab-text-field>
    </div>
    <fab-command-bar tabindex="1"  [attr.id]="'fab-command-bar'" [contentClass]="'fab-command-bar-class'">
        <items>
            <!-- do not use *ngIf on these buttons  -->
            <fab-command-bar-item key="run" [text]="runButtonText" [iconProps]="runIcon" (click)="runCompilation()"
                [disabled]="runButtonDisabled"></fab-command-bar-item>
            
            <fab-command-bar-item [style]="saveButtonVisibilityStyle" key="save" [text]="saveButtonText" [iconProps]="saveIcon"
                (click)="saveDetectorCode()"></fab-command-bar-item>

            <fab-command-bar-item key="publishGrad" [text]="modalPublishingButtonText" [iconProps]="publishIcon"
                (click)="publishButtonOnClick()" [disabled]="publishButtonDisabled">
            </fab-command-bar-item>

            <!-- <fab-command-bar-item key="detectorSettings" [text]="detectorSettingsButtonText" [iconProps]="settingsIcon"
                (click)="detectorSettingsButtonOnClick()" >
            </fab-command-bar-item> -->

            <fab-command-bar-item key="detectorSettings" [text]="detectorSettingsButtonText" [iconProps]="settingsIcon"
                (click)="detectorSettingsButtonOnClick()" >
            </fab-command-bar-item>

            <far-items>
                <fab-command-bar-item *ngIf="detectorGraduation" key="brachSelectorPill" text="custom text">
                    <render>
                      <ng-template let-item="item">
                        <div style="padding-top:1px!important;">
                          <fab-default-button id="develop-tab-branch-selector" (click)="branchToggleCallout()"
                            [styles]="pillButtonStyleBranchPicker" [ariaLabel]="displayName" [iconProps]="{ iconName: 'BranchSearch' }">
                            Branch: {{displayBranch}}</fab-default-button>
                          <fab-callout [hidden]="!isBranchCallOutVisible" (onDismiss)="closeBranchCallout()" [setInitialFocus]="true"
                            [target]="'#develop-tab-branch-selector'">
                            <div class="callout-padding">
                              <div>
                                <fab-choice-group [options]="showBranches" (onChange)="updateTempBranch($event)">
                                </fab-choice-group>
                              </div>
                              <div style="border-top: 1px solid gray;" class="pt-3 pb-3 callout-padding">
                                <fab-primary-button (onClick)="updateBranch()" (keyup.enter)="updateBranch()"
                                  [ariaLabel]="'Apply'" [contentClass]="'mr-3 callout-button'" [contentStyle]="'border-radius: 2px;'">
                                  Apply
                                </fab-primary-button>
                                <fab-default-button (onClick)="closeBranchCallout()" (keyup.enter)="closeBranchCallout()"
                                  [ariaLabel]="'Cancel'" [contentStyle]="'border-radius: 2px;'">Cancel</fab-default-button>
                              </div>
                            </div>
                          </fab-callout>
                        </div>
                      </ng-template>
                    </render>
                    <render-icon>
                      <ng-template let-contextualMenuItemProps="contextualMenuItemProps">
                        <div>custom icon</div>
                      </ng-template>
                    </render-icon>
                  </fab-command-bar-item>
                <fab-command-bar-item key="timePickerPill" text="custom text">
                    <render>
                      <ng-template let-item="item">
                        <div style="padding-top:1px!important;">
                          <fab-default-button id="develop-tab-timepicker" (onClick)="openTimePickerSubject.next(true);"
                            [styles]="pillButtonStyleTimePicker" [ariaLabel]="displayName" [iconProps]="{ iconName: 'clock' }">Time range (UTC):
                            {{timePickerButtonStr}}
                          </fab-default-button>
                        </div>
                        <detector-time-picker [target]="'#develop-tab-timepicker'" [openTimePickerCalloutObservable]="openTimePickerSubject">
                        </detector-time-picker>
                      </ng-template>
                    </render>
                    <render-icon>
                      <ng-template let-contextualMenuItemProps="contextualMenuItemProps">
                        <div>custom icon</div>
                      </ng-template>
                    </render-icon>
                  </fab-command-bar-item>
            </far-items>
        </items>
    </fab-command-bar>

    <!-- <fab-panel [isOpen]="detectorSettingsPanelOpenState" [type]="PanelType.custom"  [customWidth]="'60vw'" 
        [isFooterAtBottom] = "true" [headerText]="'Configure Detector'" (onOpened)="detectorSettingsPanelOnOpened()" (onDismiss)="detectorSettingsPanelOnDismiss('Close')"  [renderFooterContent]='PanelFooter' >
        <div style="margin: 1em;">            
        </div>
    </fab-panel>
    <ng-template #PanelFooter>
        <div>
            <hr/>
            <fab-primary-button (onClick)="notifyPanelCloseSubject.next('Save')" [contentStyle]="'margin-left:10px;margin-right:10px'" >Save</fab-primary-button>
            <fab-default-button (onClick)="notifyPanelCloseSubject.next('Cancel')" [contentStyle]="'margin-left:10px;margin-right:10px'" >Cancel</fab-default-button>
        </div>
    </ng-template> -->
    <detector-settings-panel [id] = '"detectorSettingsPanel"' [mode] = "mode" [(isOpen)] = "detectorSettingsPanelOpenState" 
    (onOpened) = "onOpenedDetectorSettingsPanel()"  (onDismiss) = "onDismissDetectorSettingsPanel($event)" [(settingsValue)] = "detectorSettingsPanelValue"
     ></detector-settings-panel>

     <!-- <div class = "" style="width: 100%; height: 25em;">
      <div class = "drawBorder row" style="display: flex;justify-content: center;">
        <div class="" style="display:flex; flex-direction:column;justify-content:space-evenly;padding: 4px;">
          <div>/\</div>
          <div>\/</div>
        </div>
        <div class="drawBorder col-md-9">Something</div>
      </div>
     </div> -->

     

     <ng-container *ngFor="let element of elements; let i = index">
      <div [id]="element.id + '_rowContainer'" class="" style="width: 80%;margin:2em auto 2em auto;display: flex;">
        <div style="display: flex;width: 4%;flex-direction: column;justify-content: space-evenly;align-items: center;">
            <div>
              <fab-link [disabled]="i==0" (onClick)="moveElementUp(element, i, $event)">
                <fab-icon [iconName]="'CaretSolidUp'" ></fab-icon>
              </fab-link>
            </div>
            <div>
              <fab-link [disabled] = "i == elements.length-1" (onClick)="moveElementDown(element, i, $event)">
                <fab-icon [iconName]="'CaretSolidDown'" ></fab-icon>
            </fab-link></div>
        </div>
        <div class="composerEleBorder"  style="width: 96%;">
            <div style="width: 100%; display: flex;justify-content:space-between">
              <div>
                <fab-text-field [ariaLabel]="'Name'" [styles]="fabTextFieldStyleNoStretch" 
                        [required]="true" [getErrorMessage]="getRequiredErrorMessageOnTextField" [(value)]="element.queryName"
                        [autoComplete]="'off'"  (onBlur)="removeSpacesFromQueryName(element, $event)"></fab-text-field>
              </div>
              <div style="display:flex;font-size:large;">
                <div style="padding-left: 2px;padding-right: 15px;">
                  <fab-dropdown [ariaLabel]="'Render as'" [options]="renderingTypeOptions" (onChange)="onRenderingTypeChange(element, i, $event)"
                  [id]="element.id + '_renderingType'" [styles]="fabDropdownStyle" [selectedKey] = "element.renderingType"
                  >
                  </fab-dropdown>
                </div>
                <div style="padding-left: 2px;padding-right: 15px;">
                  <fab-link [ariaLabel]="'Preview'" (onClick)="previewResults(element, i, $event)">
                    <fab-icon [iconName]="'Play'" ></fab-icon>
                  </fab-link>
                </div>
                <div style="padding-left: 2px;padding-right: 15px;">
                  <fab-link [ariaLabel]="'Duplicate'" (onClick)="duplicateElement(element, i, $event)">
                    <fab-icon [iconName]="'Copy'" ></fab-icon>
                  </fab-link>
                </div>
                <div style="padding-left: 2px;padding-right: 15px;">
                  <fab-link [ariaLabel]="'Delete'" (onClick)="deleteElement(element, i, $event)">
                    <fab-icon [iconName]="'Delete'" ></fab-icon>
                  </fab-link>
                </div>
              </div>              
            </div>
            <div>
              <fab-pivot [styles]="pivotStyle">
                <fab-pivot-item [headerText]="'Query'" [itemKey]="'Query'">
                  <div class = "pivotItemContainer">
                    <ngx-monaco-editor (onInit)="setMocanoReference(element, i, $event)" style="height:calc(98%)" [options]="editorOptions"
                      [(ngModel)]="element.code">
                    </ngx-monaco-editor>
                  </div>
                </fab-pivot-item>
                <fab-pivot-item [headerText]="'Settings'" [itemKey]="'Settings'">
                  <div class = "pivotItemContainer">
                    Settings for {{RenderingType[element.renderingType]}}
                  </div>
                </fab-pivot-item>
                <fab-pivot-item [headerText]="'Result'" [itemKey]="'Result'">
                  <div class = "pivotItemContainer">
                    Render result/error here
                  </div>
                </fab-pivot-item>
              </fab-pivot>
              <!-- {{i}} - {{element.queryName}} <br/> <br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/> -->
            </div>
        </div>
      </div>
    </ng-container>
</div>